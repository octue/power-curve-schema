{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "type": "object",
  "title": "Turbine Power Curve",
  "description": "Define a wind turbine power curve.",
  "definitions": {
    "1darray": {
      "type": "array",
      "items": {
        "type": "number"
      },
      "additionalItems": true
    },
    "2darray": {
      "type": "array",
      "items": {
        "type": "array",
        "items": {
          "type": "number"
        },
        "additionalItems": true
      },
      "additionalItems": true
    },
    "3darray": {
      "type": "array",
      "items": {
        "type": "array",
        "items": {
          "type": "array",
          "items": {
            "type": "number"
          },
          "additionalItems": true
        },
        "additionalItems": true
      },
      "additionalItems": true
    },
    "4darray": {
      "type": "array",
      "items": {
        "type": "array",
        "items": {
          "type": "array",
          "items": {
            "type": "array",
            "items": {
              "type": "number"
            },
            "additionalItems": true
          },
          "additionalItems": true
        },
        "additionalItems": true
      },
      "additionalItems": true
    }
  },
  "required": [
    "document_version",
    "turbine_metadata",
    "design_parameters",
    "default_mode",
    "modes"
  ],
  "properties": {
    "label": {
      "type": "string",
      "title": "Power curve label",
      "description": "An optional slugified string key used to reference this power curve, eg siemens-swt-whatever. This is best used as an identifier within a database or graph (in the same way that mode labels are used to reference a given mode within the power curve - see the 'modes' property)",
      "pattern": "^([a-z][a-z0-9]*)(-[a-z0-9]+)*$",
      "message": {
        "pattern": "Correct format of the label is kebab-case (lowercase, numeric digits and hyphens only)"
      },
      "examples": ["example-simple"]
    },
    "document_version": {
      "type": "string",
      "title": "Document version",
      "description": "Manufacturer's document reference (from which raw power curves data is taken)",
      "message": {
        "required": "Document version is a required property"
      },
      "examples": ["Vestas Document no. 0067-7067 V09, 2018-09-25"]
    },
    "turbine_metadata": {
      "type": "object",
      "title": "Turbine metadata",
      "description": "General information (metadata) about the turbine",
      "required": [
        "name",
        "manufacturer",
        "nominal_rated_power",
        "rotor_diameter",
        "description",
        "available_hub_heights",
        "drive_type",
        "regulation_type"
      ],
      "properties": {
        "name": {
          "type": "string",
          "title": "Turbine name",
          "description": "Name of the turbine model (according to the manufacturer)",
          "examples": ["Example Simple Turbine Name"]
        },
        "manufacturer": {
          "type": "string",
          "title": "Manufacturer name",
          "description": "Name of the manufacturer",
          "examples": ["Example Turbines PLC"]
        },
        "nominal_rated_power": {
          "type": "number",
          "title": "Nominal rated power [W]",
          "description": "Nominal rated power of the turbine in W",
          "examples": [5000000]
        },
        "rotor_diameter": {
          "type": "number",
          "title": "Rotor diameter [m]",
          "description": "Nominal rotor diameter of the turbine in m",
          "examples": [100.0]
        },
        "description": {
          "type": "string",
          "title": "Turbine description",
          "description": "Notes which will be rendered into help popups for the turbine.",
          "examples": ["An example simple turbine with only one mode."]
        },
        "available_hub_heights": {
          "type": "array",
          "title": "Available hub heights",
          "description": "1D array [1 x H] containing hub heights [m] at which the turbine can be ordered.",
          "additionalItems": true,
          "items": {
            "type": "number"
          }
        },
        "drive_type": {
          "type": "string",
          "title": "Drive type",
          "description": "The drive type of the turbine",
          "enum": ["geared", "direct", "other"]
        },
        "regulation_type": {
          "type": "string",
          "title": "Regulation type",
          "description": "The regulation type of the turbine.",
          "enum": ["pitch", "stall", "other"]
        }
      },
      "additionalProperties": true
    },
    "design_basis": {
      "type": "object",
      "title": "Design basis",
      "description": "Information about the design point (environmental conditions) the power curves in this document are certified for.",
      "required": [],
      "properties": {
        "iec_class": {
          "type": "string",
          "title": "IEC class",
          "description": "The IEC class rules under which the turbine was designed and certified",
          "default": "",
          "examples": ["SomeTechnicalPaper:12345"]
        },
        "average_wind_speed": {
          "type": "number",
          "title": "Average wind speed [m/s]",
          "description": " The V_ave 10-minute average wind speed for which the turbine is certified in m/s",
          "default": 0,
          "examples": [40]
        },
        "extreme_wind_speed": {
          "type": "number",
          "title": "Extreme wind speed [m/s]",
          "description": " The V50 10-minute extreme wind speed for which the turbine is certified in m/s",
          "default": 0,
          "examples": [40]
        },
        "survival_wind_speed": {
          "type": "number",
          "title": "Survival wind speed [m/s]",
          "description": "The Ve50 3s gust wind speed for which the turbine is certified m/s"
        },
        "turbulent_intensity_v50": {
          "type": "number",
          "title": "Turbulent Intensity [%]",
          "description": "The V50 design value of turbulent intensity I"
        },
        "turbulent_intensity_iec61400_ref": {
          "title": "Turbulent Intensity [%]",
          "description": "The reference value of turbulent intensity I, according to IEC61400-1",
          "anyOf": [
            {
              "type": "number"
            },
            {
              "type": "object",
              "properties": {
                "min": {
                  "type": "number",
                  "inclusiveMinimum": 0,
                  "inclusiveMaximum": 30
                },
                "max": {
                  "type": "number",
                  "inclusiveMinimum": 0,
                  "inclusiveMaximum": 30
                }
              }
            }
          ]
        },
        "turbulent_intensity_iec61400_wft": {
          "type": "number",
          "title": "Turbulent Intensity [%]",
          "description": "The V90 extreme value of turbulent intensity I, according to IEC61400-1, including wind farm turbulence @15m/s"
        },
        "weibull_scale_factor_c": {
          "type": "number",
          "title": "Weibull Scale Factor, C",
          "description": "The Weibull distribution scale factor"
        },
        "weibull_shape_factor_k": {
          "type": "number",
          "title": "Weibull Shape Factor, k",
          "description": "The Weibull distribution shape factor k"
        },
        "alpha": {
          "type": "number",
          "title": "Alpha",
          "description": "The design wind shear exponent"
        },
        "inflow_angle": {
          "title": "Inflow Angle",
          "description": "The design vertical inflow angle",
          "anyOf": [
            {
              "type": "number"
            },
            {
              "type": "object",
              "properties": {
                "min": {
                  "type": "number",
                  "exclusiveMinimum": -20,
                  "exclusiveMaximum": 20
                },
                "max": {
                  "type": "number",
                  "exclusiveMinimum": -20,
                  "exclusiveMaximum": 20
                }
              }
            }
          ]
        },
        "grid_voltage": {
          "type": "number",
          "title": "Grid voltage [V]",
          "description": "The design grid voltage in V"
        },
        "grid_frequencies": {
          "type": "array",
          "items": {
            "type": "number"
          },
          "title": "Grid frequencies [Hz]",
          "description": "The allowable design grid frequencies in Hz"
        },
        "operational_temperature": {
          "title": "Operational temperature",
          "description": "The allowable range of operational temperature in degree celcius",
          "type": "object",
          "required": ["max"],
          "properties": {
            "min": {
              "type": "number",
              "exclusiveMinimum": -273.15,
              "exclusiveMaximum": 1000
            },
            "max": {
              "type": "number",
              "exclusiveMinimum": -273.15,
              "exclusiveMaximum": 1000
            }
          }
        }
      },
      "additionalProperties": false
    },
    "default_mode": {
      "type": "string",
      "title": "Default mode",
      "description": "The label of the mode that should be used by default (must match an entry in 'modes')"
    },
    "modes": {
      "type": "array",
      "title": "Modes",
      "description": "Different modes that the turbine can operate in / switch between",
      "additionalItems": true,
      "items": {
        "type": "object",
        "required": [
          "label",
          "description",
          "cut",
          "parameters",
          "cp_is_coefficient",
          "ct_is_coefficient",
          "cp",
          "ct",
          "rated_power"
        ],
        "properties": {
          "label": {
            "type": "string",
            "title": "Mode label",
            "description": " A string key identifying the mode, e.g. `PO1 power-optimised`",
            "pattern": "^[A-Za-z0-9-_ ]{1,30}$"
          },
          "description": {
            "type": "string",
            "title": "Mode description",
            "description": "Short human readable text which will be rendered into dropdowns and made searchable."
          },
          "rated_power": {
            "type": "number",
            "title": "Mode rated power (W)",
            "description": "Rated power of the turbine in this mode [W]"
          },
          "cut_in": {
            "title": "Cut in",
            "description": "A description of the cut in characteristics (a discontinuity in the power curve at low speeds)",
            "type": "object",
            "properties": {
              "kind": {
                "title": "Cut in characteristic",
                "description": "Select the kind of cut in characteristic to apply",
                "default": "cut_in_step",
                "enum": ["cut_in_step", "cut_in_triangle", "cut_in_recut_out"]
              }
            },
            "allOf": [
              {
                "if": {
                  "properties": {
                    "kind": {
                      "const": "cut_in_step"
                    }
                  }
                },
                "then": {
                  "properties": {
                    "cut_in_speed": {
                      "title": "Cut in speed [m/s]",
                      "type": "number",
                      "default": 0
                    }
                  }
                }
              },
              {
                "if": {
                  "properties": {
                    "kind": {
                      "const": "cut_in_triangle"
                    }
                  }
                },
                "then": {
                  "properties": {
                    "cut_in_start_speed": {
                      "title": "Cut in ramp start speed [m/s]",
                      "type": "number"
                    },
                    "cut_in_end_speed": {
                      "title": "Cut in ramp end speed [m/s]",
                      "type": "number"
                    }
                  }
                }
              },
              {
                "if": {
                  "properties": {
                    "kind": {
                      "const": "cut_in_recut_out"
                    }
                  }
                },
                "then": {
                  "properties": {
                    "cut_in_speed": {
                      "title": "Cut in speed [m/s]",
                      "type": "number"
                    },
                    "recut_out_speed": {
                      "title": "Re-cut out speed [m/s]",
                      "description": "As wind speed decreases back to zero, this is the speed at which the turbine will cut out. Should be less than the cut in speed.",
                      "type": "number"
                    }
                  }
                }
              }
            ]
          },
          "cut_out": {
            "title": "Cut out",
            "description": "A description of the cut out characteristics (a discontinuity in the power curve at high wind speeds)",
            "type": "object",
            "properties": {
              "kind": {
                "title": "Cut out characteristic",
                "description": "Select the kind of cut out characteristic to apply",
                "default": "cut_out_step",
                "enum": ["cut_out_step", "cut_out_triangle", "cut_out_recut_in"]
              }
            },
            "allOf": [
              {
                "if": {
                  "properties": {
                    "kind": {
                      "const": "cut_out_step"
                    }
                  }
                },
                "then": {
                  "properties": {
                    "cut_out_speed": {
                      "title": "Cut out speed [m/s]",
                      "description": "Wind speed above which the turbine is cut out, and below which it cuts back in",
                      "type": "number"
                    }
                  }
                }
              },
              {
                "if": {
                  "properties": {
                    "kind": {
                      "const": "cut_out_triangle"
                    }
                  }
                },
                "then": {
                  "properties": {
                    "start_speed": {
                      "title": "Cut out ramp start speed [m/s]",
                      "description": "Wind speed above which the power starts to ramp down",
                      "type": "number"
                    },
                    "end_speed": {
                      "title": "Cut out ramp end speed [m/s]",
                      "description": "Wind speed above which the cut out ramp is complete",
                      "type": "number"
                    }
                  }
                }
              },
              {
                "if": {
                  "properties": {
                    "kind": {
                      "const": "cut_out_recut_in"
                    }
                  }
                },
                "then": {
                  "properties": {
                    "cut_out_speed": {
                      "title": "Cut out speed [m/s]",
                      "description": "Wind speed above which the turbine is cut out",
                      "type": "number"
                    },
                    "recut_out_speed": {
                      "title": "Re-cut in speed [m/s]",
                      "description": "As wind speed decreases back toward zero, this is the speed at which the turbine will cut back in. Should be less than the cut out speed.",
                      "type": "number"
                    }
                  }
                }
              }
            ]
          },
          "parameters": {
            "type": "array",
            "title": "Parameters",
            "description": "Independent parameters for which the power curve is described",
            "additionalItems": true,
            "items": {
              "type": "object",
              "required": ["label", "dimension", "points"],
              "properties": {
                "label": {
                  "type": "string",
                  "title": "Parameter label",
                  "description": "A slugified string key used to identify the parameter (e.g. air-density)"
                },
                "dimension": {
                  "type": "integer",
                  "title": "Dimension",
                  "description": "Dimension of the power curve array along which this parameter varies (0-based)"
                },
                "points": {
                  "type": "array",
                  "title": "Points",
                  "description": "Sampling points of this parameter corresponding to points on the power curve",
                  "additionalItems": true,
                  "items": {
                    "type": "number"
                  }
                }
              }
            }
          },
          "cp_is_coefficient": {
            "type": "boolean",
            "title": "Cp is Coefficient",
            "description": "True if the `cp` array is in nondimensional coefficient form, False if the `cp` array contains Power [W]."
          },
          "ct_is_coefficient": {
            "type": "boolean",
            "title": "Ct is Coefficient",
            "description": "True if the `ct` array is in nondimensional coefficient form, False if the `ct` array contains Thrust [kgms^-2]."
          },
          "cp": {
            "title": "Power Curve [cp]",
            "description": "The coefficient of power, defined as an N-D array at the sample points described in 'Parameters'",
            "oneOf": [
              {
                "title": "2 Parameters (2D Array, e.g. air-density and wind-speed)",
                "type": "array",
                "$ref": "#/definitions/2darray"
              },
              {
                "title": "3 Parameters (3D Array, e.g. turbulent-intensity, air-density and wind-speed)",
                "type": "array",
                "$ref": "#/definitions/3darray"
              },
              {
                "title": "4 Parameters (4D Array, e.g. monin-obukhov-stability, turbulent-intensity, air-density and wind-speed)",
                "type": "array",
                "$ref": "#/definitions/4darray"
              }
            ]
          },
          "ct": {
            "title": "Thrust Curve [ct]",
            "description": "The coefficient of thrust, defined as an N-D array at the sample points described in 'Parameters'",
            "oneOf": [
              {
                "title": "2 Parameters (2D Array, e.g. air-density and wind-speed)",
                "type": "array",
                "$ref": "#/definitions/2darray"
              },
              {
                "title": "3 Parameters (3D Array, e.g. turbulent-intensity, air-density and wind-speed)",
                "type": "array",
                "$ref": "#/definitions/3darray"
              },
              {
                "title": "4 Parameters (4D Array, e.g. monin-obukhov-stability, turbulent-intensity, air-density and wind-speed)",
                "type": "array",
                "$ref": "#/definitions/4darray"
              }
            ]
          }
        }
      }
    }
  },
  "additionalProperties": true
}
